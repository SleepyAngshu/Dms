{% extends 'base.html' %}

{% block title %}Verify Doctors{% endblock %}

{% block extra_css %}
<style>
    .page-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
    }
    
    .status-badge {
        display: inline-block;
        padding: 5px 10px;
        border-radius: 20px;
        font-size: 14px;
        font-weight: bold;
        margin-left: 10px;
    }
    
    .status-pending {
        background-color: #f39c12;
        color: white;
    }
    
    .status-verified {
        background-color: #2ecc71;
        color: white;
    }
    
    .status-rejected {
        background-color: #e74c3c;
        color: white;
    }
    
    .doctor-block {
        background-color: white;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        padding: 20px;
        margin-bottom: 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        position: relative;
        transition: transform 0.2s, box-shadow 0.2s;
    }
    
    .doctor-block:hover {
        transform: translateY(-5px);
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
    }
    
    .doctor-info {
        width: 70%;
    }
    
    .doctor-info h2 {
        margin: 0;
        color: #34495e;
        display: flex;
        align-items: center;
    }
    
    .doctor-info p {
        margin: 5px 0;
        color: #7f8c8d;
    }
    
    .doctor-meta {
        margin-top: 10px;
        font-size: 14px;
        color: #95a5a6;
    }
    
    .buttons {
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        position: absolute;
        right: 20px;
        top: 20px;
    }
    
    .buttons form {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }
    
    .buttons button {
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        transition: background-color 0.2s, transform 0.1s;
    }
    
    .buttons .confirm-btn {
        background-color: #2ecc71;
        color: white;
    }
    
    .buttons .cancel-btn {
        background-color: #e74c3c;
        color: white;
    }
    
    .buttons button:hover {
        opacity: 0.9;
        transform: scale(1.05);
    }
    
    .buttons button:active {
        transform: scale(0.98);
    }
    
    .confirmed {
        color: #27ae60;
        font-weight: bold;
        font-size: 16px;
        display: flex;
        align-items: center;
    }
    
    .confirmed::before {
        content: "✓";
        margin-right: 5px;
        font-size: 18px;
    }
    
    .cancelled {
        color: #e74c3c;
        font-weight: bold;
        display: flex;
        align-items: center;
    }
    
    .cancelled::before {
        content: "✗";
        margin-right: 5px;
        font-size: 18px;
    }
    
    .filters {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
    }
    
    .filter-btn {
        padding: 8px 15px;
        border: 1px solid #ddd;
        border-radius: 20px;
        background-color: white;
        cursor: pointer;
        transition: all 0.2s;
    }
    
    .filter-btn.active {
        background-color: #007bff;
        color: white;
        border-color: #007bff;
    }
    
    .no-doctors {
        text-align: center;
        padding: 40px;
        background-color: white;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }
    
    .no-doctors p {
        color: #7f8c8d;
        font-size: 18px;
    }
    
    .section-divider {
        margin: 30px 0;
        border-top: 1px solid #ddd;
        position: relative;
    }
    
    .section-divider span {
        position: absolute;
        top: -12px;
        left: 20px;
        background-color: #ecf0f1;
        padding: 0 10px;
        color: #7f8c8d;
    }
</style>
{% endblock %}

{% block content %}
<div class="page-header">
    <h1>Verify Doctors</h1>
    {% if pending_count > 0 %}
        <span class="status-badge status-pending">{{ pending_count }} Pending</span>
    {% else %}
        <span class="status-badge status-verified">All Verified</span>
    {% endif %}
</div>

<div class="filters">
    <button class="filter-btn active" data-filter="all">All</button>
    <button class="filter-btn" data-filter="pending">Pending</button>
    <button class="filter-btn" data-filter="verified">Verified</button>
    <button class="filter-btn" data-filter="rejected">Rejected</button>
</div>

{% set has_pending = false %}
{% for doctor in doctors %}
    {% if doctor.verified == 0 %}
        {% set has_pending = true %}
    {% endif %}
{% endfor %}

{% if has_pending %}
    <div class="section-divider">
        <span>Pending Verification</span>
    </div>
    
    {% for doctor in doctors %}
        {% if doctor.verified == 0 %}
            <div class="doctor-block" id="doctor{{ doctor.d_id }}" data-status="pending">
                <div class="doctor-info">
                    <h2>{{ doctor.name }} <span class="status-badge status-pending">Pending</span></h2>
                    <p><strong>Designation:</strong> {{ doctor.designation }}</p>
                    <p><strong>Email:</strong> {{ doctor.email }}</p>
                    <div class="doctor-meta">
                        <p>Doctor ID: {{ doctor.d_id }}</p>
                    </div>
                </div>
                
                <div class="buttons" id="buttons{{ doctor.d_id }}">
                    <form action="{{ url_for('admin_verify', _anchor='doctor' + doctor.d_id|string) }}" method="post">      
                        <input type="hidden" name="d_id" value="{{ doctor.d_id }}">
                        <button class="confirm-btn" name="action" value="Confirm" type="submit">Verify Doctor</button>
                        <button class="cancel-btn" name="action" value="Cancel" type="submit">Reject</button>
                    </form>
                </div>
            </div>
        {% endif %}
    {% endfor %}
{% endif %}

<div class="section-divider">
    <span>Verified Doctors</span>
</div>

{% set has_verified = false %}
{% for doctor in doctors %}
    {% if doctor.verified == 1 %}
        {% set has_verified = true %}
        <div class="doctor-block" id="doctor{{ doctor.d_id }}" data-status="verified">
            <div class="doctor-info">
                <h2>{{ doctor.name }} <span class="status-badge status-verified">Verified</span></h2>
                <p><strong>Designation:</strong> {{ doctor.designation }}</p>
                <p><strong>Email:</strong> {{ doctor.email }}</p>
                <div class="doctor-meta">
                    <p>Doctor ID: {{ doctor.d_id }}</p>
                </div>
            </div>
            <div class="confirmed">Verified</div>
        </div>
    {% endif %}
{% endfor %}

{% if not has_verified %}
    <div class="no-doctors" data-status="verified">
        <p>No verified doctors found.</p>
    </div>
{% endif %}

<div class="section-divider">
    <span>Rejected Applications</span>
</div>

{% set has_rejected = false %}
{% for doctor in doctors %}
    {% if doctor.verified == 2 %}
        {% set has_rejected = true %}
        <div class="doctor-block" id="doctor{{ doctor.d_id }}" data-status="rejected">
            <div class="doctor-info">
                <h2>{{ doctor.name }} <span class="status-badge status-rejected">Rejected</span></h2>
                <p><strong>Designation:</strong> {{ doctor.designation }}</p>
                <p><strong>Email:</strong> {{ doctor.email }}</p>
                <div class="doctor-meta">
                    <p>Doctor ID: {{ doctor.d_id }}</p>
                </div>
            </div>
            <div class="cancelled">Rejected</div>
        </div>
    {% endif %}
{% endfor %}

{% if not has_rejected %}
    <div class="no-doctors" data-status="rejected">
        <p>No rejected applications found.</p>
    </div>
{% endif %}

{% if doctors|length == 0 %}
    <div class="no-doctors">
        <p>No doctors found in the system.</p>
    </div>
{% endif %}
{% endblock %}

{% block extra_js %}
<script>
    window.onload = function() {
        // Check if the URL contains a fragment (e.g., #doctor3)
        const hash = window.location.hash;
        if (hash) {
            const element = document.querySelector(hash);
            if (element) {
                // Scroll to the doctor block smoothly
                element.scrollIntoView({
                    behavior: 'smooth'
                });
                
                // Add highlight effect
                element.style.backgroundColor = '#fffde7';
                setTimeout(() => {
                    element.style.transition = 'background-color 1s ease';
                    element.style.backgroundColor = 'white';
                }, 100);
            }
        }
        
        // Filter functionality
        const filterButtons = document.querySelectorAll('.filter-btn');
        const doctorBlocks = document.querySelectorAll('.doctor-block');
        const noDoctorsMessages = document.querySelectorAll('.no-doctors');
        
        filterButtons.forEach(button => {
            button.addEventListener('click', () => {
                // Remove active class from all buttons
                filterButtons.forEach(btn => btn.classList.remove('active'));
                
                // Add active class to clicked button
                button.classList.add('active');
                
                const filter = button.getAttribute('data-filter');
                
                // Show/hide doctor blocks based on filter
                doctorBlocks.forEach(block => {
                    if (filter === 'all' || block.getAttribute('data-status') === filter) {
                        block.style.display = 'flex';
                    } else {
                        block.style.display = 'none';
                    }
                });
                
                // Show/hide "no doctors" messages based on filter
                noDoctorsMessages.forEach(msg => {
                    if (filter === 'all') {
                        msg.style.display = 'none';
                    } else if (msg.getAttribute('data-status') === filter) {
                        // Check if there are any visible doctor blocks with this status
                        const visibleBlocks = document.querySelectorAll(`.doctor-block[data-status="${filter}"]`);
                        msg.style.display = visibleBlocks.length > 0 ? 'none' : 'block';
                    } else {
                        msg.style.display = 'none';
                    }
                });
                
                // Show "no doctors" message if no doctors are visible
                if (filter === 'all' && doctorBlocks.length === 0) {
                    document.querySelector('.no-doctors').style.display = 'block';
                }
            });
        });
    };
</script>
{% endblock %}